# ddWebSocket

ddWebSocket is a library for hosting websites and running server-side code
written in C#.

## Dependencies
- .NET 5.0 SDK
- doxygen for building the documentation (optional)

## Building
On windows, you can use VisualStudio to open the .csproj files and build it using
the GUI.

On linux, or if you dont want to use VisualStudio, you can run
```sh
dotnet build ddserver.csproj
```
in the command line to build the project.

The example chat app can be run in the same way. If you're on the command line,
just replace `dotnet build` with `dotnet run`.

The project was tested on linux and using the Brave browser, but there should be
no problem running it with any other setup.

For building the documentation you need to have installed `doxygen` and run
```sh
doxygen Doxyfile
```
After that you will find the build files in the `docs` subdirectory

## How it works
The server accepts HTTP requests in a loop and tries to satisfy them.
The default behavior is to just GET the static file, if it exists or return 404.
If routes are configured, they take priority when resolving the request(see the
Router class for more info).
If WebSockets are configured and the received HTTP request is a WebSocket upgrade,
the server accepts it and sends it to the Hub for management.

For more information see the autogenerated documentation or the source code.

## Configuration
Before starting the server, it must be configured. A minimal example could look
something like this:
```csharp
var server = new WebServer(pathToWebRootDirectory, portToListenOn);
```
The `pathToWebRootDirectory` parameter is just a string path to the directory
where your website files reside. The port parameter is quite self-explanatory.
The server will be started on all available network interfaces with the given port.

### Routes
You can register configured Routes by calling the `AddRoute` method on the server.
A route consists of a HTTP `Verb`, a `Path` and a `Handler`. The route is then executed
when a request with the method `Verb` on the path `Path` is received and the `Handler`
delegate is called to process it.
Look at the Controller class or the Handler.cs file to see how a Handler looks.

### WebSockets
To use WebSockets you want to create a class that derives the Hub class and override
the OnReceive method. This method will get called every time a message is received
on the WebSocket and should return a processed message that will get sent back to the clients.

Currently there is no support for specifying which clients should receive the message,
although it is supported on the server a is just hardcoded to use the current room
from the chat app example.

## The chatApp example
The chatApp example project uses the library to start a server and on it a webapp
that allows users to chat in the browser in realtime over WebSockets.

Users can register an account and after logging in create or join a chatroom. After that
they can chat with other users using a familiar interface.

### Notes
On the login page, pressing register or login with incorrect credentials seems to do nothing.
That is because result of that operation is only visible in the server console.

After loggin in, one can create a chatroom by clicking the + button at the top and then 'create'.
To join a chatroom, you need the chatroom GUID which can be obtained by a member of that chatroom
by clicking on the chatroom name in the top left of the page which will store it in
the clipboard. The just press the + button again, paste in the ID and click join.
Now if you click the cog button, the new chatroom should be present in the dropdown menu.
The cog button is then used to switch the active chatroom.

Sessions are saved per endpoint ip so if you want to try chatting with multiple users, you need
(sadly) multiple IP's. The server listens on multiple interfaces so you should at least have 
the localhost IP address and your local network IP. For one user, navigate to the site
at `localhost:5555` and for the other go to `192.168.x.x:5555` etc.
This is bad design, but the workaround ist super difficult and I couldnt figure out
how to make this  work better.

Also if 2 users share a chatroom but one of the is not in there at the moment(theyre chatting in some other chatroom),
the message isnt delivered, which is expected behavior. You dont want to see messages
mixed from all your chatrooms at once.

Messages and chatrooms are saved on the server so you can logout and come back to see your past messages
and even everything that happened while you were gone.

